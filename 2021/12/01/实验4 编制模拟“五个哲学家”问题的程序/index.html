<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>实验4 编制模拟“五个哲学家”问题的程序 | Riceater</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.1"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><header><nav><a href="/">Home</a><a href="/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>实验4 编制模拟“五个哲学家”问题的程序</h1><hr></div><div id="post-content"><h5 id="实验目的："><a href="#实验目的：" class="headerlink" title="实验目的："></a>实验目的：</h5><p>学习和掌握并发进程同步的概念和方法。</p>
<h5 id="实验内容："><a href="#实验内容：" class="headerlink" title="实验内容："></a>实验内容：</h5><p>11、程序语法<br>        <code>philosopher   [ -t  &lt;time&gt; ]</code></p>
<p><code>&lt;time&gt;</code>是哲学家进餐和沉思的持续时间值，缺省值为2秒。<br>2、五个哲学家的编号为0~4，分别用五个进程独立模拟。<br>3、程序的输出要简洁，仅输出每个哲学家进餐和沉思的信息。</p>
<p>例如，当编号为3的哲学家在进餐时，就打印：<br>        <code>philosopher 3 is eating</code><br>而当他在沉思时，则打印：<br>         <code>philosopher 3 is thinking</code><br>除此之外不要输出其他任何信息。<br>4、利用课堂已教授的知识而不使用线程或IPC机制进行同步。</p>
<p>5、程序应该一直运行，直到人为地终止它（按Ctrl-C或Ctrl-\）。不允许出现僵尸进程。<br>6、 12月3日24点为实验完成deadline。</p>
<h5 id="实验准备："><a href="#实验准备：" class="headerlink" title="实验准备："></a>实验准备：</h5><p>首先了解一下什么是哲学家进餐问题：</p>
<p>学家就餐问题可以这样表述，假设有五位哲学家围坐在一张圆形餐桌旁，做以下两件事情之一：吃饭，或者思考。吃东西的时候，他们就停止思考，思考的时候也停止吃东西。餐桌中间有一大碗意大利面，每两个哲学家之间有一只餐叉。因为用一只餐叉很难吃到意大利面，所以假设哲学家必须用两只餐叉吃东西。他们只能使用自己左右手边的那两只餐叉。哲学家就餐问题有时也用米饭和筷子而不是意大利面和餐叉来描述，因为很明显，吃米饭必须用两根筷子。</p>
<p>哲学家从来不交谈，这就很危险，可能产生死锁，每个哲学家都拿着左手的餐叉，永远都在等右边的餐叉（或者相反）。即使没有死锁，也有可能发生资源耗尽。例如，假设规定当哲学家等待另一只餐叉超过五分钟后就放下自己手里的那一只餐叉，并且再等五分钟后进行下一次尝试。这个策略消除了死锁（系统总会进入到下一个状态），但仍然有可能发生“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B4%BB%E9%94%81">活锁</a>”。如果五位哲学家在完全相同的时刻进入餐厅，并同时拿起左边的餐叉，那么这些哲学家就会等待五分钟，同时放下手中的餐叉，再等五分钟，又同时拿起这些餐叉。</p>
<p>在实际的计算机问题中，缺乏餐叉可以类比为缺乏共享资源。一种常用的计算机技术是资源加锁，用来保证在某个时刻，资源只能被一个程序或一段代码访问。当一个程序想要使用的资源已经被另一个程序锁定，它就等待资源解锁。当多个程序涉及到加锁的资源时，在某些情况下就有可能发生死锁。例如，某个程序需要访问两个文件，当两个这样的程序各锁了一个文件，那它们都在等待对方解锁另一个文件，而这永远不会发生。</p>
<h5 id="实验设计思路："><a href="#实验设计思路：" class="headerlink" title="实验设计思路："></a>实验设计思路：</h5><p>看了看网上的思路，要解决哲学家进餐问题的核心应该是解决死锁情况，即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">五个哲学家同时取他左边的叉子，每个人持有一只叉子一段时间，并在相同时间放下后又同时拿起左边的叉子。<br></code></pre></td></tr></table></figure>

<p>解决这个问题的思路就是人为设定一个哲学家会去先拿右边的叉子。</p>
<h6 id="实验代码："><a href="#实验代码：" class="headerlink" title="实验代码："></a>实验代码：</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;apue.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initlock</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *lockfile)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br><br>    unlink(lockfile);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *lockfile)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd;<br>    <span class="hljs-keyword">while</span> ((fd = open(lockfile, O_RDONLY | O_CREAT | O_EXCL, FILE_MODE)) &lt; <span class="hljs-number">0</span>)<br>        sleep(<span class="hljs-number">1</span>);<br>    close(fd);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *lockfile)</span></span><br><span class="hljs-function"></span>&#123;<br>    unlink(lockfile);<br>&#125;<br><span class="hljs-comment">// 定义5个文件，分别表示5个叉子。其文件名可以按如下方式说明：</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 5</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *forks[<span class="hljs-number">5</span>] = &#123;<span class="hljs-string">&quot;forks0&quot;</span>, <span class="hljs-string">&quot;forks1&quot;</span>, <span class="hljs-string">&quot;forks2&quot;</span>, <span class="hljs-string">&quot;forks3&quot;</span>, <span class="hljs-string">&quot;forks4&quot;</span>&#125;;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> nsecs = <span class="hljs-number">2</span>;<br><span class="hljs-comment">// 哲学家的行为可以用如下函数描述：</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">philosopher</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        thinking(i, nsecs); <span class="hljs-comment">// 哲学家i思考nsecs秒</span><br>        takeFork(i);        <span class="hljs-comment">// 哲学家i拿起叉子</span><br>        eating(i, nsecs);   <span class="hljs-comment">// 哲学家i进餐nsecs秒</span><br>        putFork(i);         <span class="hljs-comment">// 哲学家i放下叉子</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">// 拿起叉子可以如此定义：</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">takeFork</span><span class="hljs-params">(i)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//假定第N-1位哲学家是右撇子</span><br>    <span class="hljs-keyword">if</span> (i == N - <span class="hljs-number">1</span>)<br>    &#123;<br>        lock(forks[<span class="hljs-number">0</span>]);<br>        lock(forks[i]);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        lock(forks[i]);<br>        lock(forks[i + <span class="hljs-number">1</span>]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 放下叉子可以如此定义：</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putFork</span><span class="hljs-params">(i)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (i == N - <span class="hljs-number">1</span>)<br>    &#123;<br>        unlock(forks[<span class="hljs-number">0</span>]);<br>        unlock(forks[i]);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        unlock(forks[i]);<br>        unlock(forks[i + <span class="hljs-number">1</span>]);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">thinking</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> nsecs)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;philosopher %d is thinking \n&quot;</span>, i);<br>    sleep(nsecs);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">eating</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> nsecs)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;philosopher %d is eating\n&quot;</span>, i);<br>    sleep(nsecs);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">pid_t</span> pid;<br>    <span class="hljs-comment">// 在主程序里，可以用下面的程序段生成5个哲学家进程：</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>        initlock(forks[i]);<br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">3</span> &amp;&amp; !<span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;-t&quot;</span>))<br>        nsecs = atoi(argv[<span class="hljs-number">2</span>]);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>)<br>        err_quit(<span class="hljs-string">&quot;usage:philosopher [ -t &lt;time&gt; ]&quot;</span>);<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>    &#123;<br>        pid = fork();<br>        <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<br>            philosopher(i);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>)<br>            err_quit(<span class="hljs-string">&quot;fork error&quot;</span>);<br>    &#125;<br>    wait(<span class="hljs-literal">NULL</span>); <span class="hljs-comment">/* 注意，如果父进程不等待子进程的结束，那么需要终止程序运行时，就只能从控制台删除在后台运行的哲学家进程 */</span><br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="实验结果："><a href="#实验结果：" class="headerlink" title="实验结果："></a>实验结果：</h5><h6 id="源程序名：philosopher-c"><a href="#源程序名：philosopher-c" class="headerlink" title="源程序名：philosopher.c"></a>源程序名：philosopher.c</h6><h6 id="可执行程序名：philosopher"><a href="#可执行程序名：philosopher" class="headerlink" title="可执行程序名：philosopher"></a>可执行程序名：philosopher</h6><p>如何编译生成可执行程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">gcc philosopher.c error_my.c -o philosopher：<br></code></pre></td></tr></table></figure>

<p>程序执行过程：</p>
<p><img src="/2021/12/01/%E5%AE%9E%E9%AA%8C4%20%E7%BC%96%E5%88%B6%E6%A8%A1%E6%8B%9F%E2%80%9C%E4%BA%94%E4%B8%AA%E5%93%B2%E5%AD%A6%E5%AE%B6%E2%80%9D%E9%97%AE%E9%A2%98%E7%9A%84%E7%A8%8B%E5%BA%8F/image-20211202232319274.png"></p>
<p><img src="/2021/12/01/%E5%AE%9E%E9%AA%8C4%20%E7%BC%96%E5%88%B6%E6%A8%A1%E6%8B%9F%E2%80%9C%E4%BA%94%E4%B8%AA%E5%93%B2%E5%AD%A6%E5%AE%B6%E2%80%9D%E9%97%AE%E9%A2%98%E7%9A%84%E7%A8%8B%E5%BA%8F/image-20211202232452731.png"></p>
<h5 id="实验体会与心得："><a href="#实验体会与心得：" class="headerlink" title="实验体会与心得："></a>实验体会与心得：</h5><p>这次实验我学会了如何用文件来实现各进程之间的交互，并且了解到了哲学家进餐这一计算机经典问题。</p>
<div id="paginator"></div></div><div id="post-footer"><hr><a href="/2021/12/14/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E3%80%8B%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C%E5%9B%9B%20%E8%BF%90%E7%94%A8ns-3%E5%88%86%E6%9E%90%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE/">← Prev 《计算机网络与通信》课程实验四 运用ns-3分析路由协议</a><span style="color: #fe2"> | </span><a href="/2021/11/28/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%8E%E9%80%9A%E4%BF%A1%E3%80%8B%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C%E4%B8%89%20Socket%E9%80%9A%E4%BF%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">《计算机网络与通信》课程实验三 Socket通信程序设计 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.Blackfankt</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">9</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">3</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">2</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">实验目的：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">实验内容：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%87%86%E5%A4%87%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">实验准备：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">实验设计思路：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">实验代码：</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">实验结果：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%BA%90%E7%A8%8B%E5%BA%8F%E5%90%8D%EF%BC%9Aphilosopher-c"><span class="toc-number">5.1.</span> <span class="toc-text">源程序名：philosopher.c</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E5%90%8D%EF%BC%9Aphilosopher"><span class="toc-number">5.2.</span> <span class="toc-text">可执行程序名：philosopher</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%BD%93%E4%BC%9A%E4%B8%8E%E5%BF%83%E5%BE%97%EF%BC%9A"><span class="toc-number">6.</span> <span class="toc-text">实验体会与心得：</span></a></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">2020 to 2021</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script></body></html>